{
  "task_id": "sanitize_clean_v2",
  "type": "python",
  "steps": [
    {
      "code": "Certo! Ecco uno script Python che esegue la tua richiesta:\n\n```python\nimport os\nimport re\n\ndef find_first_code_line(content):\n    \"\"\"Trova la prima riga di codice reale in un file.\"\"\"\n    lines = content.split('\\n')\n    for i, line in enumerate(lines):\n        if re.search(r'^\\s*(import|from\\s+[\\w\\.]+\\s+import\\s+[\\w\\.]+|\\bdef\\b|<!DOCTYPE)', line):\n            return '\\n'.join(lines[i:])\n    return content\n\ndef process_file(file_path):\n    \"\"\"Processa un file, rimuovendo tutto ci\u00f2 che precede la prima riga di codice.\"\"\"\n    with open(file_path, 'r', encoding='utf-8') as file:\n        content = file.read()\n    \n    new_content = find_first_code_line(content)\n    \n    if new_content != content:\n        with open(file_path, 'w', encoding='utf-8') as file:\n            file.write(new_content)\n\ndef walk_directory(directory):\n    \"\"\"Cammina nella directory e processa i file .py e .html.\"\"\"\n    for root, _, files in os.walk(directory):\n        for file_name in files:\n            if file_name.endswith('.py') or file_name.endswith('.html'):\n                file_path = os.path.join(root, file_name)\n                process_file(file_path)\n\nif __name__ == \"__main__\":\n    base_directory = os.path.expanduser(\"~/panda/projects/\")\n    walk_directory(base_directory)\n```\n\n### Spiegazione del codice:\n\n1. **find_first_code_line(content)**:\n   - Questa funzione prende il contenuto di un file e cerca la prima riga che inizia con `import`, `from ... import ...`, una definizione di funzione (`def`), o una dichiarazione HTML (`<!DOCTYPE)`).\n   - Restituisce tutto il contenuto a partire dalla prima riga di codice reale.\n\n2. **process_file(file_path)**:\n   - Questa funzione legge il file specificato, cerca la prima riga di codice reale usando `find_first_code_line`, e sostituisce il contenuto del file con quello che segue la prima linea di codice reale.\n\n3. **walk_directory(directory)**:\n   - Questa funzione cammina attraverso tutte le sottodirectory della directory specificata (`base_directory`), processando ogni file `.py` o `.html` usando `process_file`.\n\n4. **main**:\n   - Il blocco `if __name__ == \"__main__\":` imposta la directory di base come `$HOME/panda/projects/` e chiama `walk_directory()` per iniziare il processo.\n\n### Utilizzo:\n\n1. Assicurati di avere i permessi necessari per leggere e scrivere nei file nella directory `~/panda/projects/`.\n2. Salva lo script in un file, ad esempio `clean_code.py`.\n3. Esegui lo script nel terminale con il comando: `python clean_code.py`.\n\nQuesto script rimuover\u00e0 tutto ci\u00f2 che precede la prima riga di codice reale in tutti i file `.py` e `.html` nella directory specificata.",
      "result": {
        "success": false,
        "stdout": "",
        "stderr": "  File \"/home/michele/panda/scripts/temp_1769879806.py\", line 42\n    - Questa funzione prende il contenuto di un file e cerca la prima riga che inizia con `import`, `from ... import ...`, una definizione di funzione (`def`), o una dichiarazione HTML (`<!DOCTYPE)`).\n                                                                                                                                                                                                      ^\nSyntaxError: unmatched ')'\n"
      }
    }
  ],
  "success": false
}