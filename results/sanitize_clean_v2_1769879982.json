{
  "task_id": "sanitize_clean_v2",
  "type": "python",
  "steps": [
    {
      "code": "Certo! Ecco uno script Python che esegue le operazioni richieste:\n\n```python\nimport os\nimport re\n\ndef remove_before_first_code(file_path):\n    with open(file_path, 'r', encoding='utf-8') as file:\n        content = file.read()\n\n    # Ricerca la prima linea di codice (riga che inizia con import, def o <!DOCTYPE)\n    pattern = r'^(import\\s+|def\\s+\\w+\\s*\\(|<!DOCTYPE\\b).*$'\n    first_code_line_index = next((i for i, line in enumerate(content.split('\\n')) if re.match(pattern, line)), None)\n\n    if first_code_line_index is not None:\n        # Rimuovi tutto ci\u00f2 che precede la prima linea di codice\n        content = '\\n'.join(content.split('\\n')[first_code_line_index:])\n\n    with open(file_path, 'w', encoding='utf-8') as file:\n        file.write(content)\n\ndef process_directory(directory):\n    for root, _, files in os.walk(directory):\n        for file_name in files:\n            if file_name.endswith('.py') or file_name.endswith('.html'):\n                file_path = os.path.join(root, file_name)\n                print(f\"Processing {file_path}\")\n                \n                with open(file_path, 'r', encoding='utf-8') as file:\n                    content = file.read()\n                    \n                    # Controlla se il file contiene le stringhe 'Certamente' o 'Ecco il codice'\n                    if 'Certamente' in content or 'Ecco il codice' in content:\n                        remove_before_first_code(file_path)\n                        print(f\"Processed and updated {file_path}\")\n\nif __name__ == \"__main__\":\n    directory = os.path.expanduser(\"~/panda/projects\")\n    process_directory(directory)\n```\n\n### Spiegazione del Codice:\n\n1. **remove_before_first_code(file_path):**\n   - Questa funzione legge il contenuto del file specificato.\n   - Utilizza una regex per trovare la prima linea di codice (che inizia con `import`, `def`, o `<!DOCTYPE`).\n   - Rimuove tutto ci\u00f2 che precede questa linea e salva il file modificato.\n\n2. **process_directory(directory):**\n   - Questa funzione cammina attraverso tutti i file nella directory specificata (`~/panda/projects`).\n   - Controlla se il file termina con `.py` o `.html`.\n   - Se contiene le stringhe 'Certamente' o 'Ecco il codice', chiama la funzione `remove_before_first_code`.\n\n3. **main:**\n   - Espande il percorso della directory home dell'utente e inizia a processare i file nella directory specificata.\n\n### Come Funziona:\n- Il script scorre tutti i file `.py` e `.html` nella directory `~/panda/projects`.\n- Per ogni file che contiene le stringhe 'Certamente' o 'Ecco il codice', elimina tutto ci\u00f2 che precede la prima linea di codice reale.\n- Salva i file modificati.\n\n### Nota:\nAssicurati di avere i permessi necessari per leggere e scrivere nei file nella directory specificata. Se esistono file lock o altri problemi di permesso, potrebbe essere necessario gestire questi casi in modo appropriato.",
      "result": {
        "success": false,
        "stdout": "",
        "stderr": "  File \"/home/michele/panda/scripts/temp_1769879982.py\", line 55\n    - Espande il percorso della directory home dell'utente e inizia a processare i file nella directory specificata.\n                                                   ^\nSyntaxError: unterminated string literal (detected at line 55)\n"
      }
    }
  ],
  "success": false
}