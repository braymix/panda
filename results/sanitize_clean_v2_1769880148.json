{
  "task_id": "sanitize_clean_v2",
  "type": "python",
  "steps": [
    {
      "code": "Ecco uno script Python che esegue le operazioni richieste:\n\n```python\nimport os\nimport re\n\ndef is_valid_python_or_html(file_path):\n    return file_path.endswith('.py') or file_path.endswith('.html')\n\ndef is_code_line(line):\n    line = line.strip()\n    if not line:\n        return False\n    # Semplice controllo per vedere se la linea contiene codice Python o HTML\n    return not (line.startswith('#') or re.match(r'^\\s*import', line) or re.match(r'^\\s*def ', line) or re.match(r'^<!DOCTYPE', line))\n\ndef remove_before_first_code_line(content):\n    lines = content.split('\\n')\n    for i, line in enumerate(lines):\n        if is_code_line(line):\n            return '\\n'.join(lines[i:])\n    return content\n\ndef process_file(file_path):\n    with open(file_path, 'r') as file:\n        content = file.read()\n    \n    new_content = remove_before_first_code_line(content)\n    \n    if content != new_content:\n        with open(file_path, 'w') as file:\n            file.write(new_content)\n        print(f\"Processed {file_path}\")\n\ndef main():\n    projects_dir = os.path.expanduser(\"~/panda/projects/\")\n    for root, dirs, files in os.walk(projects_dir):\n        for file_name in files:\n            if is_valid_python_or_html(file_name):\n                file_path = os.path.join(root, file_name)\n                process_file(file_path)\n\nif __name__ == \"__main__\":\n    main()\n```\n\n### Come funziona lo script:\n\n1. **is_valid_python_or_html**: Controlla se il nome del file termina con `.py` o `.html`.\n\n2. **is_code_line**: Verifica se una linea contiene codice Python (non commenti, `import`, `def`) o HTML (`<!DOCTYPE`).\n\n3. **remove_before_first_code_line**: Rimuove tutte le righe prima della prima riga di codice reale.\n\n4. **process_file**: Legge il contenuto del file, rimuove il materiale in eccesso e lo salva nuovamente se \u00e8 stato modificato.\n\n5. **main**: Utilizza `os.walk` per scorrere tutti i file nella directory `~/panda/projects/`, applicando la funzione di elaborazione a ogni `.py` o `.html`.\n\n### Considerazioni:\n- Questo script assume che le righe che iniziano con `#` siano commenti (Python) e non codice.\n- L'indicizzazione di cosa sia \"codice\" \u00e8 molto semplice: controlla solo l'assenza di `import`, `def`, o `<!DOCTYPE`. Puoi modificare questa funzione per essere pi\u00f9 accurata se necessario.\n- Questo script sovrascrive i file originali. Se desideri mantenere un backup, aggiungi una linea di codice per salvare il contenuto originale prima della modifica.\n\nQuesto script dovrebbe soddisfare le tue esigenze basate su una ricerca semplice delle stringhe specificate e rimozione del materiale in eccesso.",
      "result": {
        "success": false,
        "stdout": "",
        "stderr": "  File \"/home/michele/panda/scripts/temp_1769880148.py\", line 1\n    Ecco uno script Python che esegue le operazioni richieste:\n         ^^^\nSyntaxError: invalid syntax\n"
      }
    }
  ],
  "success": false
}